<?xml version="1.0" encoding="UTF-8"?>
  <!--
    ~ Licensed to the Apache Software Foundation (ASF) under one ~ or more contributor license agreements. See the NOTICE file ~ distributed with this work for additional information ~ regarding copyright ownership. The ASF licenses this file ~ to you under the Apache License, Version 2.0 (the ~ "License"); you may not use this file except in compliance ~ with the License. You may obtain a copy of the License at ~ ~ http://www.apache.org/licenses/LICENSE-2.0 ~ ~ Unless required by applicable law or agreed to in writing, ~ software distributed under the License is distributed on an ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY ~ KIND, either express or implied. See the License for the ~ specific
    language governing permissions and limitations ~ under the License.
  -->
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xmlns:util="http://www.springframework.org/schema/util" xmlns:http-conf="http://cxf.apache.org/transports/http/configuration" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:jaxws="http://cxf.apache.org/jaxws" xmlns:cxf="http://cxf.apache.org/core" xmlns:htd="http://www.example.org/WS-HT" xmlns:htda="http://www.example.org/WS-HT/api" xmlns:htdt="http://www.example.org/WS-HT/api/xsd" xmlns:htdaw="http://www.example.org/WS-HT/api/wsdl" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ins="http://www.insurance.example.com/claims"
  xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.0.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd
       http://cxf.apache.org/transports/http/configuration http://cxf.apache.org/schemas/configuration/http-conf.xsd
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
       http://cxf.apache.org/core http://cxf.apache.org/schemas/core.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
       ">

  <import resource="classpath:META-INF/cxf/cxf.xml"/>
  <import resource="classpath:META-INF/cxf/cxf-extension-soap.xml"/>
  <import resource="classpath:META-INF/cxf/cxf-servlet.xml"/>

<!-- 
  <bean id="hisePasswordCallback" class="org.apache.hise.engine.MapPasswordCallback">
    <property name="passwords" ref="hiseLoginProperties"/>
  </bean>
   -->

<!-- 
  <bean id="transactionHandler" class="org.apache.hise.engine.jaxws.TransactionHandler">
    <property name="transactionManager" ref="transactionManager"/>
  </bean>
   -->

  <bean id="hiseDao" class="org.apache.hise.dao.HISEDao">
    <property name="entityManagerFactory" ref="htEntityManagerFactory"/>
  </bean>

  <bean id="hiseEngine" class="org.apache.hise.engine.HISEEngine">
    <property name="hiseDao" ref="hiseDao"/>
    <property name="hiseScheduler" ref="hiseScheduler"/>
    <property name="hiseUserDetails" ref="hiseUserDetails"/>
  </bean>

  <bean id="hiseUserDetails" class="org.apache.hise.engine.DefaultHISEUserDetails">
    <property name="hiseDao" ref="hiseDao"/>
  </bean>

  <bean id="hisePasswordCallback" class="org.apache.hise.engine.HISEPasswordCallback">
    <property name="hiseUserDetails" ref="hiseUserDetails"/>
  </bean>
  
  <bean id="hiseScheduler" class="org.apache.hise.engine.HISEScheduler" init-method="init" destroy-method="destroy">
    <property name="hiseEngine" ref="hiseEngine"/>
    <property name="transactionManager" ref="transactionManager"/>
  </bean>

  <tx:annotation-driven transaction-manager="transactionManager"/>

  <!--
  <util:properties id="hiseLoginProperties" location="classpath:hise-login.properties"/>
  -->

  <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
    <property name="entityManagerFactory" ref="htEntityManagerFactory"/>
    <property name="dataSource" ref="dataSource"/>
  </bean>

  <bean name="taskOperations" class="org.apache.hise.engine.jaxws.TaskOperationsImpl" init-method="init">
    <property name="hiseEngine" ref="hiseEngine"/>
  </bean>

  <jaxws:endpoint id="taskOperationsEndpoint" name="taskOperationsEndpoint" address="/taskOperations/" implementor="#taskOperations" serviceName="htdaw:taskOperations" publish="true"  wsdlLocation="ws-humantask.wsdl">
  <!-- 
    <jaxws:handlers>
      <ref bean="transactionHandler"/>
    </jaxws:handlers>
     -->
    <jaxws:inInterceptors>
      <bean class="org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor">
        <constructor-arg>
          <map>
            <entry key="action" value="UsernameToken"/>
            <entry key="passwordType" value="PasswordDigest"/>
            <entry key="passwordCallbackRef">
              <ref bean="hisePasswordCallback"/>
            </entry>
          </map>
        </constructor-arg>
      </bean>
    </jaxws:inInterceptors>
  </jaxws:endpoint>

  <bean id="logInbound" class="org.apache.cxf.interceptor.LoggingInInterceptor"/>
  <bean id="logOutbound" class="org.apache.cxf.interceptor.LoggingOutInterceptor"/>

  <cxf:bus>
    <cxf:inInterceptors>
      <ref bean="logInbound"/>
    </cxf:inInterceptors>
    <cxf:outInterceptors>
      <ref bean="logOutbound"/>
    </cxf:outInterceptors>
    <cxf:inFaultInterceptors>
      <ref bean="logInbound"/>
    </cxf:inFaultInterceptors>
    <cxf:outFaultInterceptors>
      <ref bean="logOutbound"/>
    </cxf:outFaultInterceptors>
  </cxf:bus>
</beans>
